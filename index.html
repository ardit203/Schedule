<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<!--    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #f6f7fb;
            --card: #ffffff;
            --grid: #d7dce3;
            --text: #111827;
            --muted: #6b7280;
            --radius: 14px;
            --shadow: 0 10px 30px rgba(17, 24, 39, .08);

            --time-col: 140px;
            --header-h: 56px;
            --slot-h: 56px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 24px;
            background: var(--bg);
            font-family: 'Exo 2', sans-serif;
            color: var(--text);
        }

        /* container feel */
        .grid {
            /*font-family: 'Exo 2', sans-serif;*/
            font-family: 'Open Sans', sans-serif;
            display: grid;
            grid-template-columns: 120px repeat(5, 30%);
            grid-template-rows: repeat(14, 10%);
            /*gap: 8px;*/
        }

        /* generic cell */
        .item,
        .empty-item,
        .dummy-item,
        .time-item {
            border-right: 1px solid var(--grid);
            border-bottom: 1px solid var(--grid);
            width: 100%;
            height: 100%;
            padding: 2px;
        }

        /* top-left blank corner */
        .time-item.corner {
            background: #fbfbfd;
            position: sticky;
            top: 0;
            left: 0;
            z-index: 5;
        }

        /* day header cells */
        .item.header {
            background: #fbfbfd;
            font-weight: 800;
            letter-spacing: .3px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 4;
        }

        /* time column cells */
        .time-item {
            background: #fbfbfd;
            font-weight: 800;
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            position: sticky;
            left: 0;
            z-index: 3;
        }

        /* empty slots */
        .empty-item {
            background: linear-gradient(#fff, #fff) padding-box,
            repeating-linear-gradient(
                    45deg,
                    rgba(17, 24, 39, .02) 0,
                    rgba(17, 24, 39, .02) 8px,
                    rgba(17, 24, 39, 0) 8px,
                    rgba(17, 24, 39, 0) 16px
            );
        }

        /* holder for stacked lessons inside a slot */
        .dummy-item {
            display: flex;
            gap: 8px;
            padding: 8px;
            background: #fff;
        }

        /* each lesson block */
        .sub-item {
            flex: 1;
            min-width: 0;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, .28);
            box-shadow: 0 8px 18px rgba(17, 24, 39, .12);
            padding: 8px 10px;

            display: grid;
            grid-template-rows: auto 1fr auto;
            overflow: hidden;
        }

        /* top/bottom info */
        .small {
            font-size: 10px;
            line-height: 1.1;
            opacity: .95;
            color: rgba(255, 255, 255, .95);
            text-shadow: 0 1px 0 rgba(0, 0, 0, .2);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* subject name */
        .sub-item h3 {
            margin: 6px 0;
            font-size: 14px;
            font-weight: 900;
            line-height: 1.15;
            /*color: rgba(255, 255, 255, .98);*/
            text-align: center;
            text-shadow: 0 1px 0 rgba(0, 0, 0, .25);

            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2; /* max 2 lines */
            -webkit-box-orient: vertical;
        }

        /* align "start/center/end" */
        .align-start {
            text-align: left;
        }

        .align-center {
            text-align: center;
        }

        .align-end {
            text-align: right;
        }

        /* nicer look on very dark colors */
        .sub-item {
            backdrop-filter: blur(2px);
        }

        /* make the first row headers look better with sticky */
        .grid > *:nth-child(-n + 6) {
            border-top: none;
        }

        /* optional: reduce borders on outer edge */
        .grid > *:nth-child(6n) {
            border-right: none;
        }

        .name {
            padding-top: 5px;
            /*padding-bottom: 2px;*/
        }
    </style>

</head>
<body>
<div id="main" class="grid"></div>
<script>
    let times = [
        "8:00 - 8:45",
        "9:00 - 9:45",
        "10:00 - 10:45",
        "11:00 - 11:45",
        "12:00 - 12:45",
        "13:00 - 13:45",
        "14:00 - 14:45",
        "15:00 - 15:45",
        "16:00 - 16:45",
        "17:00 - 17:45",
        "18:00 - 18:45",
        "19:00 - 19:45",
        "20:00 - 20:45",
    ]
    let startPeriod = 0 //inclusive
    let endPeriod = 13 //exclusive
    let startDayCode = -1 //inclusive
    let endDayCode = 5 //exclusive
    let days = null
    let data = null
    let main = document.getElementById("main")

    fetchJson()

    async function fetchJson() {
        let response = await fetch('./schedule.json')
        let json = await response.json()
        days = json.days
        data = json.data
        console.log(json.type == undefined)
        console.log(days)
        console.log(data)
        build()
    }

    function build() {
        //days
        createDiv('time-item corner') // blank corner

        for (const day in days) {
            createDiv('item header', day)
        }

        for (let i = startPeriod; i < endPeriod; i++) {
            for (let j = startDayCode; j < endDayCode; j++) {
                if (j === startDayCode) {
                    createDiv('time-item', times[i])
                    continue
                }
                let filter = data.filter(d => d['Day code'] === j && d['Periods'].includes(i))
                createNestedDiv(filter)
            }
        }
    }

    function createDiv(className = 'empty-item', text = "", color = "") {
        let div = document.createElement("div");
        div.innerHTML = text;
        div.className = className;          // <-- important (uses passed class)
        if (color) div.style.background = color;
        main.appendChild(div);
        return div;
    }


    function createNestedDiv(items) {
        let level = items.length
        let div = createDiv('dummy-item')
        if (level === 0) {
            div.classList.remove('dummy-item')
            div.classList.add('empty-item')
            return
        }

        for (let item of items) {
            let innerDiv = document.createElement("div")
            innerDiv.classList.add('sub-item')
            innerDiv.style.background = item['Color']


            let roomAndGroup = document.createElement("div")
            roomAndGroup.style.display = 'flex'
            roomAndGroup.style.justifyContent = 'space-between'
            roomAndGroup.style.gap = '10px'

            let roomDiv = document.createElement("div")
            roomDiv.classList.add('small')
            roomDiv.textContent = item['Classrooms']
            roomAndGroup.appendChild(roomDiv)

            if (item['Classes'] != undefined) {
                let classDiv = document.createElement("div")
                classDiv.classList.add('small')
                classDiv.textContent = item['Classes']
                roomAndGroup.appendChild(classDiv)
            }
            innerDiv.appendChild(roomAndGroup)

            let name = createFields("h3", item['Short name'], 'center', 'name')
            innerDiv.appendChild(name)

            if (item['Teachers'] != undefined) {
                let prof = createFields("div", item['Teachers'], 'end', 'small')
                innerDiv.appendChild(prof)
            }

            div.appendChild(innerDiv)
        }
    }

    function createFields(type, text, align, className = '') {
        let field = document.createElement(type)
        field.innerHTML = text
        field.style.textAlign = align
        field.classList.add(className)
        return field
    }


</script>

</body>
</html>